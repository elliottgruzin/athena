<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Athena — Client Feedback Survey</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

:root {
  --color-ivory: #FAF9F0;
  --color-charcoal: #1A1D23;
  --color-charcoal-light: #2A2D35;
  --color-slate: #4A4E57;
  --color-slate-light: #8B8F99;
  --color-amber: #C8943F;
  --color-amber-dark: #A67A2E;
  --color-cloud: #EFEFEF;
  --color-border: #DDDDD8;
  --color-red: #E05555;
  --color-yellow: #D4A843;
  --color-green: #5AAE6D;

  --font-heading: 'DM Serif Display', serif;
  --font-body: 'Inter', sans-serif;

  --fs-hero: clamp(2rem, 4vw + 0.5rem, 3.5rem);
  --fs-h2: clamp(1.5rem, 2.5vw + 0.5rem, 2.5rem);
  --fs-h3: clamp(1.15rem, 1.2vw + 0.5rem, 1.5rem);
  --fs-body: clamp(0.95rem, 0.5vw + 0.75rem, 1.125rem);
  --fs-small: clamp(0.8rem, 0.4vw + 0.65rem, 0.9rem);

  --container: min(960px, 90%);
  --transition-base: 0.3s ease;
}

::selection { background: var(--color-amber); color: var(--color-ivory); }

html { scroll-behavior: smooth; }

body {
  font-family: var(--font-body);
  font-size: var(--fs-body);
  line-height: 1.7;
  color: var(--color-charcoal);
  background: var(--color-ivory);
  -webkit-font-smoothing: antialiased;
}

:focus-visible {
  outline: 2px solid var(--color-amber);
  outline-offset: 3px;
}

.container { width: var(--container); margin-inline: auto; }

/* ── Header ── */
.header {
  background: var(--color-charcoal);
  padding: 1rem 0;
}
.header .container {
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.header-logo {
  font-family: var(--font-heading);
  font-size: 1.5rem;
  color: var(--color-ivory);
  text-decoration: none;
}
.header-logo span { color: var(--color-amber); }
.header-back {
  color: var(--color-slate-light);
  text-decoration: none;
  font-size: var(--fs-small);
  font-weight: 500;
  transition: color var(--transition-base);
}
.header-back:hover { color: var(--color-amber); }

/* ── Tabs ── */
.tabs {
  background: var(--color-charcoal);
  border-bottom: 1px solid rgba(255,255,255,0.08);
  padding: 0;
}
.tabs .container { display: flex; gap: 0; }
.tab-btn {
  padding: 1rem 2rem;
  background: none;
  border: none;
  color: var(--color-slate-light);
  font-family: var(--font-body);
  font-size: var(--fs-small);
  font-weight: 600;
  cursor: pointer;
  border-bottom: 2px solid transparent;
  transition: color var(--transition-base), border-color var(--transition-base);
}
.tab-btn:hover { color: var(--color-ivory); }
.tab-btn.active {
  color: var(--color-ivory);
  border-bottom-color: var(--color-amber);
}

/* ── Survey Section ── */
.survey-section {
  padding: 4rem 0;
}
.survey-intro {
  text-align: center;
  margin-bottom: 3rem;
}
.survey-intro h1 {
  font-family: var(--font-heading);
  font-size: var(--fs-hero);
  margin-bottom: 0.75rem;
}
.survey-intro p {
  color: var(--color-slate);
  max-width: 550px;
  margin-inline: auto;
}

/* NPS Score Selector */
.nps-question {
  text-align: center;
  margin-bottom: 2.5rem;
}
.nps-question h2 {
  font-family: var(--font-heading);
  font-size: var(--fs-h3);
  margin-bottom: 0.5rem;
}
.nps-question p {
  color: var(--color-slate-light);
  font-size: var(--fs-small);
  margin-bottom: 1.5rem;
}
.nps-scale {
  display: flex;
  justify-content: center;
  gap: 0.5rem;
  flex-wrap: wrap;
}
.nps-btn {
  width: 52px;
  height: 52px;
  border-radius: 0.5rem;
  border: 2px solid var(--color-border);
  background: #fff;
  font-family: var(--font-body);
  font-size: 1rem;
  font-weight: 600;
  color: var(--color-slate);
  cursor: pointer;
  transition: all var(--transition-base);
}
.nps-btn:hover {
  border-color: var(--color-amber);
  color: var(--color-amber);
}
.nps-btn.selected {
  color: #fff;
  border-color: transparent;
}
.nps-btn.detractor.selected { background: var(--color-red); }
.nps-btn.passive.selected { background: var(--color-yellow); }
.nps-btn.promoter.selected { background: var(--color-green); }

.nps-labels {
  display: flex;
  justify-content: space-between;
  max-width: 580px;
  margin: 0.5rem auto 0;
  font-size: 0.75rem;
  color: var(--color-slate-light);
}

/* Form Fields */
.survey-form {
  max-width: 560px;
  margin-inline: auto;
}
.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
  margin-bottom: 1rem;
}
.form-group {
  margin-bottom: 1rem;
}
.form-group label {
  display: block;
  font-size: var(--fs-small);
  font-weight: 600;
  color: var(--color-charcoal);
  margin-bottom: 0.35rem;
}
.form-group label .optional {
  font-weight: 400;
  color: var(--color-slate-light);
}
.form-group input,
.form-group textarea {
  width: 100%;
  padding: 0.75rem 1rem;
  border: 1px solid var(--color-border);
  border-radius: 0.25rem;
  font-family: var(--font-body);
  font-size: var(--fs-body);
  color: var(--color-charcoal);
  background: #fff;
  transition: border-color var(--transition-base);
}
.form-group textarea { min-height: 100px; resize: vertical; }
.form-group input:focus,
.form-group textarea:focus {
  outline: none;
  border-color: var(--color-amber);
}
.form-error-msg {
  color: var(--color-red);
  font-size: 0.8rem;
  margin-top: 0.25rem;
  display: none;
}
.form-group.error input,
.form-group.error textarea { border-color: var(--color-red); }
.form-group.error .form-error-msg { display: block; }

.btn {
  display: inline-block;
  padding: 0.85rem 2rem;
  border-radius: 0.25rem;
  font-family: var(--font-body);
  font-size: var(--fs-small);
  font-weight: 600;
  text-decoration: none;
  cursor: pointer;
  transition: background var(--transition-base), transform var(--transition-base);
  border: 2px solid transparent;
}
.btn-primary {
  background: var(--color-amber);
  color: var(--color-charcoal);
  width: 100%;
  text-align: center;
}
.btn-primary:hover {
  background: var(--color-amber-dark);
  transform: translateY(-1px);
}
.btn-primary:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

/* Success */
.survey-success {
  text-align: center;
  padding: 4rem 1rem;
  display: none;
}
.survey-success.show { display: block; }
.success-icon {
  width: 72px; height: 72px;
  border-radius: 50%;
  background: rgba(90, 174, 109, 0.12);
  display: flex; align-items: center; justify-content: center;
  margin: 0 auto 1.5rem;
  font-size: 2rem;
  color: var(--color-green);
}
.survey-success h2 {
  font-family: var(--font-heading);
  font-size: var(--fs-h2);
  margin-bottom: 0.5rem;
}
.survey-success p { color: var(--color-slate); }

/* ── Dashboard Section ── */
.dashboard-section {
  padding: 4rem 0;
  display: none;
}

.dashboard-empty {
  text-align: center;
  padding: 4rem 1rem;
  color: var(--color-slate-light);
}
.dashboard-empty h2 {
  font-family: var(--font-heading);
  font-size: var(--fs-h2);
  color: var(--color-charcoal);
  margin-bottom: 0.5rem;
}

/* Score Overview */
.score-overview {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr 1fr;
  gap: 1.5rem;
  margin-bottom: 3rem;
}
.score-card {
  background: #fff;
  border-radius: 0.5rem;
  padding: 1.5rem;
  text-align: center;
  box-shadow: 0 2px 12px rgba(0,0,0,0.06);
}
.score-card .score-value {
  font-family: var(--font-heading);
  font-size: 2.5rem;
  line-height: 1;
  margin-bottom: 0.35rem;
}
.score-card .score-label {
  font-size: var(--fs-small);
  color: var(--color-slate-light);
  font-weight: 500;
}
.nps-score-value { color: var(--color-amber); }
.detractor-color { color: var(--color-red); }
.passive-color { color: var(--color-yellow); }
.promoter-color { color: var(--color-green); }

/* NPS Bar */
.nps-bar-section { margin-bottom: 3rem; }
.nps-bar-section h3 {
  font-family: var(--font-heading);
  font-size: var(--fs-h3);
  margin-bottom: 1rem;
}
.nps-bar {
  display: flex;
  height: 48px;
  border-radius: 0.5rem;
  overflow: hidden;
  background: var(--color-cloud);
}
.nps-bar-segment {
  display: flex;
  align-items: center;
  justify-content: center;
  color: #fff;
  font-size: var(--fs-small);
  font-weight: 600;
  transition: width 0.5s ease;
  min-width: 0;
}
.nps-bar-segment.detractors { background: var(--color-red); }
.nps-bar-segment.passives { background: var(--color-yellow); }
.nps-bar-segment.promoters { background: var(--color-green); }
.nps-bar-legend {
  display: flex;
  gap: 2rem;
  margin-top: 0.75rem;
  font-size: var(--fs-small);
  color: var(--color-slate);
}
.legend-dot {
  display: inline-block;
  width: 10px; height: 10px;
  border-radius: 50%;
  margin-right: 0.4rem;
  vertical-align: middle;
}

/* Distribution */
.distribution-section { margin-bottom: 3rem; }
.distribution-section h3 {
  font-family: var(--font-heading);
  font-size: var(--fs-h3);
  margin-bottom: 1rem;
}
.distribution-grid {
  display: flex;
  gap: 0.5rem;
  align-items: flex-end;
  height: 180px;
  padding-bottom: 2rem;
  position: relative;
  border-bottom: 1px solid var(--color-border);
}
.dist-bar-wrapper {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  height: 100%;
  justify-content: flex-end;
}
.dist-bar {
  width: 100%;
  max-width: 48px;
  border-radius: 0.25rem 0.25rem 0 0;
  transition: height 0.5s ease;
  position: relative;
}
.dist-bar.detractor { background: var(--color-red); }
.dist-bar.passive { background: var(--color-yellow); }
.dist-bar.promoter { background: var(--color-green); }
.dist-bar-count {
  position: absolute;
  top: -1.5rem;
  left: 50%;
  transform: translateX(-50%);
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--color-slate);
}
.dist-label {
  margin-top: 0.5rem;
  font-size: 0.8rem;
  font-weight: 600;
  color: var(--color-slate);
}

/* Responses list */
.responses-section { margin-bottom: 3rem; }
.responses-section h3 {
  font-family: var(--font-heading);
  font-size: var(--fs-h3);
  margin-bottom: 1rem;
}
.response-card {
  background: #fff;
  border-radius: 0.5rem;
  padding: 1.25rem 1.5rem;
  margin-bottom: 0.75rem;
  box-shadow: 0 2px 8px rgba(0,0,0,0.04);
  display: flex;
  align-items: flex-start;
  gap: 1rem;
}
.response-score-badge {
  flex-shrink: 0;
  width: 42px; height: 42px;
  border-radius: 0.5rem;
  display: flex; align-items: center; justify-content: center;
  font-weight: 700;
  font-size: 1rem;
  color: #fff;
}
.response-score-badge.detractor { background: var(--color-red); }
.response-score-badge.passive { background: var(--color-yellow); }
.response-score-badge.promoter { background: var(--color-green); }
.response-meta {
  font-size: var(--fs-small);
  color: var(--color-slate-light);
  margin-bottom: 0.25rem;
}
.response-meta strong { color: var(--color-charcoal); }
.response-comment {
  font-size: var(--fs-small);
  color: var(--color-slate);
  font-style: italic;
}

/* AI Visual Section */
.ai-visual-section { margin-bottom: 2rem; }
.ai-visual-section h3 {
  font-family: var(--font-heading);
  font-size: var(--fs-h3);
  margin-bottom: 0.5rem;
}
.ai-visual-section > p {
  color: var(--color-slate-light);
  font-size: var(--fs-small);
  margin-bottom: 1.25rem;
}
.generate-btn {
  background: var(--color-charcoal);
  color: var(--color-ivory);
  padding: 0.85rem 2rem;
  border-radius: 0.25rem;
  border: none;
  font-family: var(--font-body);
  font-size: var(--fs-small);
  font-weight: 600;
  cursor: pointer;
  transition: background var(--transition-base), transform var(--transition-base);
}
.generate-btn:hover {
  background: var(--color-charcoal-light);
  transform: translateY(-1px);
}
.generate-btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none;
}
.ai-loading {
  display: none;
  align-items: center;
  gap: 0.75rem;
  margin-top: 1.25rem;
  font-size: var(--fs-small);
  color: var(--color-slate);
}
.ai-loading.show { display: flex; }
.spinner {
  width: 20px; height: 20px;
  border: 2px solid var(--color-border);
  border-top-color: var(--color-amber);
  border-radius: 50%;
  animation: spin 0.7s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }

.ai-result {
  margin-top: 1.5rem;
  display: none;
}
.ai-result.show { display: block; }
.ai-result img {
  width: 100%;
  max-width: 700px;
  border-radius: 0.5rem;
  box-shadow: 0 8px 32px rgba(0,0,0,0.12);
}
.ai-error {
  display: none;
  margin-top: 1rem;
  padding: 1rem;
  background: rgba(224, 85, 85, 0.08);
  border: 1px solid rgba(224, 85, 85, 0.2);
  border-radius: 0.25rem;
  color: var(--color-red);
  font-size: var(--fs-small);
}
.ai-error.show { display: block; }

/* ── Footer ── */
.footer {
  background: var(--color-charcoal);
  color: var(--color-slate-light);
  padding: 2rem 0;
  text-align: center;
  font-size: var(--fs-small);
  border-top: 1px solid rgba(255,255,255,0.06);
}

/* ── Responsive ── */
@media (max-width: 768px) {
  .score-overview { grid-template-columns: 1fr 1fr; }
  .form-row { grid-template-columns: 1fr; }
  .nps-btn { width: 44px; height: 44px; font-size: 0.9rem; }
}
@media (max-width: 480px) {
  .nps-scale { gap: 0.35rem; }
  .nps-btn { width: 38px; height: 38px; font-size: 0.8rem; }
}

@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}
</style>
</head>
<body>

<!-- Header -->
<header class="header">
  <div class="container">
    <a href="athena.html" class="header-logo">Athena<span>.</span></a>
    <a href="athena.html" class="header-back">&larr; Back to site</a>
  </div>
</header>

<!-- Tabs -->
<div class="tabs">
  <div class="container">
    <button class="tab-btn active" data-tab="survey">Submit Feedback</button>
    <button class="tab-btn" data-tab="dashboard">Dashboard</button>
  </div>
</div>

<!-- Survey Tab -->
<section class="survey-section" id="survey-tab">
  <div class="container">
    <div class="survey-intro">
      <h1>Client Feedback</h1>
      <p>Your feedback helps us improve. Please take a moment to rate your experience working with Athena.</p>
    </div>

    <form id="nps-form">
      <!-- NPS Score -->
      <div class="nps-question">
        <h2>How likely are you to recommend Athena to a colleague?</h2>
        <p>Select a score from 0 (not at all likely) to 10 (extremely likely)</p>
        <div class="nps-scale" role="radiogroup" aria-label="Net Promoter Score">
          <button type="button" class="nps-btn detractor" data-score="0" aria-label="Score 0">0</button>
          <button type="button" class="nps-btn detractor" data-score="1" aria-label="Score 1">1</button>
          <button type="button" class="nps-btn detractor" data-score="2" aria-label="Score 2">2</button>
          <button type="button" class="nps-btn detractor" data-score="3" aria-label="Score 3">3</button>
          <button type="button" class="nps-btn detractor" data-score="4" aria-label="Score 4">4</button>
          <button type="button" class="nps-btn detractor" data-score="5" aria-label="Score 5">5</button>
          <button type="button" class="nps-btn detractor" data-score="6" aria-label="Score 6">6</button>
          <button type="button" class="nps-btn passive" data-score="7" aria-label="Score 7">7</button>
          <button type="button" class="nps-btn passive" data-score="8" aria-label="Score 8">8</button>
          <button type="button" class="nps-btn promoter" data-score="9" aria-label="Score 9">9</button>
          <button type="button" class="nps-btn promoter" data-score="10" aria-label="Score 10">10</button>
        </div>
        <div class="nps-labels">
          <span>Not at all likely</span>
          <span>Extremely likely</span>
        </div>
        <p class="form-error-msg" id="score-error" style="text-align:center; margin-top:0.5rem;">Please select a score.</p>
      </div>

      <!-- Details -->
      <div class="survey-form">
        <div class="form-row">
          <div class="form-group">
            <label for="resp-name">Your Name</label>
            <input type="text" id="resp-name" name="resp-name" autocomplete="name">
          </div>
          <div class="form-group">
            <label for="resp-company">Company <span class="optional">(optional)</span></label>
            <input type="text" id="resp-company" name="resp-company" autocomplete="organization">
          </div>
        </div>
        <div class="form-group">
          <label for="resp-comment">What's the primary reason for your score? <span class="optional">(optional)</span></label>
          <textarea id="resp-comment" name="resp-comment" rows="4"></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Submit Feedback</button>
      </div>
    </form>

    <div class="survey-success" id="survey-success">
      <div class="success-icon">&#10003;</div>
      <h2>Thank You</h2>
      <p>Your feedback has been recorded. We truly appreciate your time.</p>
    </div>
  </div>
</section>

<!-- Dashboard Tab -->
<section class="dashboard-section" id="dashboard-tab">
  <div class="container">

    <div class="dashboard-empty" id="dashboard-empty">
      <h2>No Responses Yet</h2>
      <p>Feedback submissions will appear here once clients complete the survey.</p>
    </div>

    <div id="dashboard-content" style="display:none;">
      <!-- Score Cards -->
      <div class="score-overview">
        <div class="score-card">
          <div class="score-value nps-score-value" id="nps-total">--</div>
          <div class="score-label">NPS Score</div>
        </div>
        <div class="score-card">
          <div class="score-value detractor-color" id="detractor-pct">0%</div>
          <div class="score-label">Detractors (0-6)</div>
        </div>
        <div class="score-card">
          <div class="score-value passive-color" id="passive-pct">0%</div>
          <div class="score-label">Passives (7-8)</div>
        </div>
        <div class="score-card">
          <div class="score-value promoter-color" id="promoter-pct">0%</div>
          <div class="score-label">Promoters (9-10)</div>
        </div>
      </div>

      <!-- NPS Bar -->
      <div class="nps-bar-section">
        <h3>Response Breakdown</h3>
        <div class="nps-bar" id="nps-bar"></div>
        <div class="nps-bar-legend">
          <span><span class="legend-dot" style="background:var(--color-red)"></span> Detractors</span>
          <span><span class="legend-dot" style="background:var(--color-yellow)"></span> Passives</span>
          <span><span class="legend-dot" style="background:var(--color-green)"></span> Promoters</span>
        </div>
      </div>

      <!-- Score Distribution -->
      <div class="distribution-section">
        <h3>Score Distribution</h3>
        <div class="distribution-grid" id="distribution-grid"></div>
      </div>

      <!-- AI Visualization -->
      <div class="ai-visual-section">
        <h3>AI-Generated Feedback Visualisation</h3>
        <p>Generate a unique visual summary of your client feedback data using AI image generation.</p>
        <button class="generate-btn" id="generate-btn">Generate Visualisation</button>
        <div class="ai-loading" id="ai-loading">
          <div class="spinner"></div>
          <span>Generating image with DALL-E &mdash; this may take a few seconds&hellip;</span>
        </div>
        <div class="ai-error" id="ai-error"></div>
        <div class="ai-result" id="ai-result">
          <img id="ai-image" src="" alt="AI-generated visualisation of NPS feedback data">
        </div>
      </div>

      <!-- Individual Responses -->
      <div class="responses-section">
        <h3>Individual Responses</h3>
        <div id="responses-list"></div>
      </div>
    </div>

  </div>
</section>

<!-- Footer -->
<footer class="footer">
  <div class="container">
    <p>&copy; 2026 Athena Advisory. All rights reserved.</p>
  </div>
</footer>

<script>
(function() {
  'use strict';

  var STORAGE_KEY = 'athena_nps_responses';
  var OPENAI_API_KEY = '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';

  // ── Helpers ──
  function getResponses() {
    try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; }
    catch(e) { return []; }
  }
  function saveResponses(data) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  }
  function classify(score) {
    if (score <= 6) return 'detractor';
    if (score <= 8) return 'passive';
    return 'promoter';
  }
  function calcNPS(responses) {
    if (!responses.length) return { nps: 0, detractors: 0, passives: 0, promoters: 0, dPct: 0, paPct: 0, prPct: 0 };
    var d = 0, pa = 0, pr = 0;
    responses.forEach(function(r) {
      var c = classify(r.score);
      if (c === 'detractor') d++;
      else if (c === 'passive') pa++;
      else pr++;
    });
    var total = responses.length;
    return {
      nps: Math.round((pr / total - d / total) * 100),
      detractors: d,
      passives: pa,
      promoters: pr,
      dPct: Math.round(d / total * 100),
      paPct: Math.round(pa / total * 100),
      prPct: Math.round(pr / total * 100)
    };
  }

  // ── Tab Switching ──
  var tabBtns = document.querySelectorAll('.tab-btn');
  var surveyTab = document.getElementById('survey-tab');
  var dashboardTab = document.getElementById('dashboard-tab');

  tabBtns.forEach(function(btn) {
    btn.addEventListener('click', function() {
      tabBtns.forEach(function(b) { b.classList.remove('active'); });
      btn.classList.add('active');
      var tab = btn.getAttribute('data-tab');
      if (tab === 'survey') {
        surveyTab.style.display = '';
        dashboardTab.style.display = 'none';
      } else {
        surveyTab.style.display = 'none';
        dashboardTab.style.display = 'block';
        renderDashboard();
      }
    });
  });

  // ── NPS Score Selection ──
  var selectedScore = null;
  var npsBtns = document.querySelectorAll('.nps-btn');
  var scoreError = document.getElementById('score-error');

  npsBtns.forEach(function(btn) {
    btn.addEventListener('click', function() {
      npsBtns.forEach(function(b) { b.classList.remove('selected'); });
      btn.classList.add('selected');
      selectedScore = parseInt(btn.getAttribute('data-score'), 10);
      scoreError.style.display = 'none';
    });
  });

  // ── Form Submission ──
  var form = document.getElementById('nps-form');
  var successEl = document.getElementById('survey-success');

  form.addEventListener('submit', function(e) {
    e.preventDefault();

    if (selectedScore === null) {
      scoreError.style.display = 'block';
      return;
    }

    var response = {
      score: selectedScore,
      name: document.getElementById('resp-name').value.trim() || 'Anonymous',
      company: document.getElementById('resp-company').value.trim() || '',
      comment: document.getElementById('resp-comment').value.trim() || '',
      date: new Date().toISOString()
    };

    var responses = getResponses();
    responses.push(response);
    saveResponses(responses);

    form.style.display = 'none';
    successEl.classList.add('show');
  });

  // ── Dashboard Rendering ──
  function renderDashboard() {
    var responses = getResponses();
    var emptyEl = document.getElementById('dashboard-empty');
    var contentEl = document.getElementById('dashboard-content');

    if (!responses.length) {
      emptyEl.style.display = '';
      contentEl.style.display = 'none';
      return;
    }
    emptyEl.style.display = 'none';
    contentEl.style.display = '';

    var stats = calcNPS(responses);

    // Score cards
    document.getElementById('nps-total').textContent = (stats.nps > 0 ? '+' : '') + stats.nps;
    document.getElementById('detractor-pct').textContent = stats.dPct + '%';
    document.getElementById('passive-pct').textContent = stats.paPct + '%';
    document.getElementById('promoter-pct').textContent = stats.prPct + '%';

    // NPS bar
    var barEl = document.getElementById('nps-bar');
    barEl.innerHTML = '';
    if (stats.dPct > 0) {
      var seg = document.createElement('div');
      seg.className = 'nps-bar-segment detractors';
      seg.style.width = stats.dPct + '%';
      seg.textContent = stats.dPct > 8 ? stats.dPct + '%' : '';
      barEl.appendChild(seg);
    }
    if (stats.paPct > 0) {
      var seg2 = document.createElement('div');
      seg2.className = 'nps-bar-segment passives';
      seg2.style.width = stats.paPct + '%';
      seg2.textContent = stats.paPct > 8 ? stats.paPct + '%' : '';
      barEl.appendChild(seg2);
    }
    if (stats.prPct > 0) {
      var seg3 = document.createElement('div');
      seg3.className = 'nps-bar-segment promoters';
      seg3.style.width = stats.prPct + '%';
      seg3.textContent = stats.prPct > 8 ? stats.prPct + '%' : '';
      barEl.appendChild(seg3);
    }

    // Distribution bars
    var distGrid = document.getElementById('distribution-grid');
    distGrid.innerHTML = '';
    var counts = new Array(11).fill(0);
    responses.forEach(function(r) { counts[r.score]++; });
    var maxCount = Math.max.apply(null, counts) || 1;

    for (var i = 0; i <= 10; i++) {
      var wrapper = document.createElement('div');
      wrapper.className = 'dist-bar-wrapper';
      var bar = document.createElement('div');
      bar.className = 'dist-bar ' + classify(i);
      var heightPct = counts[i] ? (counts[i] / maxCount * 100) : 0;
      bar.style.height = Math.max(heightPct, counts[i] ? 8 : 0) + '%';

      if (counts[i] > 0) {
        var countLabel = document.createElement('span');
        countLabel.className = 'dist-bar-count';
        countLabel.textContent = counts[i];
        bar.appendChild(countLabel);
      }

      var label = document.createElement('span');
      label.className = 'dist-label';
      label.textContent = i;

      wrapper.appendChild(bar);
      wrapper.appendChild(label);
      distGrid.appendChild(wrapper);
    }

    // Individual responses (newest first)
    var listEl = document.getElementById('responses-list');
    listEl.innerHTML = '';
    var sorted = responses.slice().reverse();
    sorted.forEach(function(r) {
      var card = document.createElement('div');
      card.className = 'response-card';
      var badge = document.createElement('div');
      badge.className = 'response-score-badge ' + classify(r.score);
      badge.textContent = r.score;
      var body = document.createElement('div');
      var meta = document.createElement('div');
      meta.className = 'response-meta';
      var dateStr = new Date(r.date).toLocaleDateString('en-AU', { day: 'numeric', month: 'short', year: 'numeric' });
      meta.innerHTML = '<strong>' + escapeHtml(r.name) + '</strong>' + (r.company ? ' &middot; ' + escapeHtml(r.company) : '') + ' &middot; ' + dateStr;
      body.appendChild(meta);
      if (r.comment) {
        var comment = document.createElement('div');
        comment.className = 'response-comment';
        comment.textContent = '"' + r.comment + '"';
        body.appendChild(comment);
      }
      card.appendChild(badge);
      card.appendChild(body);
      listEl.appendChild(card);
    });
  }

  function escapeHtml(str) {
    var div = document.createElement('div');
    div.appendChild(document.createTextNode(str));
    return div.innerHTML;
  }

  // ── DALL-E Image Generation ──
  var generateBtn = document.getElementById('generate-btn');
  var aiLoading = document.getElementById('ai-loading');
  var aiError = document.getElementById('ai-error');
  var aiResult = document.getElementById('ai-result');
  var aiImage = document.getElementById('ai-image');

  generateBtn.addEventListener('click', function() {
    var responses = getResponses();
    if (!responses.length) return;

    var stats = calcNPS(responses);
    var totalResponses = responses.length;

    // Build descriptive prompt from the data
    var npsLabel = stats.nps >= 50 ? 'excellent' : stats.nps >= 0 ? 'good' : 'needs improvement';

    var prompt = 'Create a clean, modern, professional infographic-style data visualisation for a consulting firm called Athena. '
      + 'The image should present Net Promoter Score (NPS) survey results with the following data: '
      + 'Overall NPS score: ' + stats.nps + ' (' + npsLabel + '). '
      + 'Total responses: ' + totalResponses + '. '
      + 'Promoters (score 9-10): ' + stats.prPct + '% (' + stats.promoters + ' responses). '
      + 'Passives (score 7-8): ' + stats.paPct + '% (' + stats.passives + ' responses). '
      + 'Detractors (score 0-6): ' + stats.dPct + '% (' + stats.detractors + ' responses). '
      + 'Use a warm, premium colour palette with dark charcoal (#1A1D23) background, ivory (#FAF9F0) text, '
      + 'and amber/gold (#C8943F) accents. Use green for promoters, amber/yellow for passives, and red for detractors. '
      + 'Include visual elements like a gauge, bar segments, and clear typography. '
      + 'The style should feel editorial, sophisticated, and data-driven — suitable for a strategy advisory firm. '
      + 'No photographs, purely graphic and typographic.';

    // Show loading, hide previous results
    generateBtn.disabled = true;
    aiLoading.classList.add('show');
    aiError.classList.remove('show');
    aiResult.classList.remove('show');

    fetch('https://api.openai.com/v1/images/generations', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer ' + OPENAI_API_KEY
      },
      body: JSON.stringify({
        model: 'dall-e-3',
        prompt: prompt,
        n: 1,
        size: '1792x1024',
        quality: 'standard'
      })
    })
    .then(function(res) {
      if (!res.ok) {
        return res.json().then(function(err) {
          throw new Error(err.error ? err.error.message : 'API request failed (' + res.status + ')');
        });
      }
      return res.json();
    })
    .then(function(data) {
      var imageUrl = data.data[0].url;
      aiImage.src = imageUrl;
      aiResult.classList.add('show');
    })
    .catch(function(err) {
      aiError.textContent = 'Error: ' + err.message;
      aiError.classList.add('show');
    })
    .finally(function() {
      generateBtn.disabled = false;
      aiLoading.classList.remove('show');
    });
  });

})();
</script>
</body>
</html>